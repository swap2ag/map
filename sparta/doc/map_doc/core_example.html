<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The Sparta Modeling Framework: Core Example Using Sparta</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">The Sparta Modeling Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('core_example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Core Example Using Sparta </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Sparta core example is located in sparta/example/CoreModel.</p>
<hr  />
 <h1><a class="anchor" id="example_core"></a>
Example Core Layout</h1>
<p>The CoreExample is an example Sparta simulator that uses the Sparta framework to mimic a very rudimentary model of a simple out-of-order core. The model does not have dependency checking nor actually renames any instructions. The "ISA" used is a few random instructions pulled from the PowerPC ISA listed in a table in <a class="el" href="Fetch_8cpp.html" title="Implementation of the CoreModel Fetch unit.">Fetch.cpp</a>.</p>
<p>For a more concrete core performance model, check out the RISC-V Performance Model based on Sparta: <a href="https://github.com/riscv-software-src/riscv-perf-model">https://github.com/riscv-software-src/riscv-perf-model</a></p>
<p>The example touches on Sparta command line simulation, construction phasing, unit creation, port creation and binding, event creation, and data transfer.</p>
<p>The ExampleCore has a simple pipeline:</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_2.png" alt="dot_inline_dotgraph_2.png" border="0" usemap="#dot_inline_dotgraph_2.map"/>
<map name="dot_inline_dotgraph_2.map" id="dot_inline_dotgraph_2.map"><area shape="rect" href="Fetch_8hpp.html" title="\N" alt="" coords="5,267,77,317"/>
<area shape="rect" href="Decode_8hpp_source.html" title="\N" alt="" coords="223,267,295,317"/>
<area shape="poly" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="78,289,209,289,209,295,78,295"/>
<area shape="rect" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="101,272,199,292"/>
<area shape="rect" href="Rename_8hpp_source.html" title="\N" alt="" coords="440,267,516,317"/>
<area shape="poly" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="295,289,426,289,426,295,295,295"/>
<area shape="rect" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="319,272,416,292"/>
<area shape="rect" href="Dispatch_8hpp_source.html" title="\N" alt="" coords="661,267,740,317"/>
<area shape="poly" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="516,289,648,289,648,295,516,295"/>
<area shape="rect" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="540,272,637,292"/>
<area shape="rect" href="Execute_8hpp_source.html" title="\N" alt="" coords="885,22,957,71"/>
<area shape="poly" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="702,268,708,212,720,144,738,81,749,57,762,41,788,27,816,22,845,23,872,28,871,33,845,29,817,28,790,32,766,45,754,59,743,83,726,145,714,213,707,268"/>
<area shape="rect" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="794,5,831,25"/>
<area shape="rect" href="Execute_8hpp_source.html" title="\N" alt="" coords="885,109,957,158"/>
<area shape="poly" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="702,267,708,238,718,203,736,169,762,142,788,129,816,122,871,122,871,127,817,127,790,134,766,146,740,172,723,205,713,239,707,268"/>
<area shape="rect" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="794,104,831,124"/>
<area shape="rect" href="Execute_8hpp_source.html" title="\N" alt="" coords="885,217,957,266"/>
<area shape="poly" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="725,265,743,253,763,243,818,232,871,232,871,238,819,238,765,248,746,257,729,270"/>
<area shape="rect" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="794,215,831,235"/>
<area shape="rect" href="Execute_8hpp_source.html" title="\N" alt="" coords="885,318,957,367"/>
<area shape="poly" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="741,306,765,313,820,326,872,334,871,340,819,331,763,319,739,311"/>
<area shape="rect" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="794,296,831,316"/>
<area shape="rect" href="LSU_8hpp_source.html" title="\N" alt="" coords="885,419,957,469"/>
<area shape="poly" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="713,315,734,354,748,374,766,391,791,407,818,420,872,435,871,440,816,425,788,412,762,395,744,378,729,357,709,318"/>
<area shape="rect" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="794,373,831,393"/>
<area shape="rect" href="ROB_8hpp_source.html" title="\N" alt="" coords="885,521,957,570"/>
<area shape="poly" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="705,316,708,355,717,404,736,454,749,477,766,497,789,515,816,527,872,540,871,545,815,532,786,519,762,501,745,480,731,456,712,405,703,356,700,316"/>
<area shape="rect" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="764,479,861,499"/>
<area shape="rect" href="BIU_8hpp_source.html" title="\N" alt="" coords="1043,419,1115,469"/>
<area shape="poly" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="957,441,1028,441,1028,447,957,447"/>
<area shape="rect" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="981,424,1019,444"/>
<area shape="rect" href="MSS_8hpp_source.html" title="\N" alt="" coords="1200,419,1272,469"/>
<area shape="poly" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="1115,441,1186,441,1186,447,1115,447"/>
<area shape="rect" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="1139,424,1176,444"/>
</map>
</div>
<p>This heirarchy is built in core_example::ExampleSimulator::buildTree_ pulling resources and factories from <a class="el" href="classcore__example_1_1CoreTopology__1.html" title="CoreTopology_1 topology class.">core_example::CoreTopology_1</a>.</p>
<p>Instructions are created in <code>Fetch</code> and progression of these instructions is based on a credit system. Credits flow from <code>ROB</code> through <code>Dispatch</code> though <code>Rename</code>, etc. in 0 time (dotted lines) while instructions flow from <code>Fetch</code> to <code>Decode</code> to <code>Rename</code>, etc (solid lines) in a delay of 1 cycle. This flow is controlled based on the rule (adopted by this example) that all <code>DataInPorts&lt;core_example::InstGroup&gt;</code> take objects delayed by 1 cycle (set at instantiation time) and all credit <code>DataInPorts&lt;uint32_t&gt;</code> are assumed to be 0 cycle. For example:</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_3.png" alt="dot_inline_dotgraph_3.png" border="0" usemap="#dot_inline_dotgraph_3.map"/>
</div>
<p>These ports are bound in core_example::ExampleSimulator::bindTree_, using the <code>port_connections</code> list defined in <a class="el" href="classcore__example_1_1CoreTopology__1.html" title="CoreTopology_1 topology class.">core_example::CoreTopology_1</a>. The ports themselves are instantiated in <a class="el" href="Fetch_8cpp.html" title="Implementation of the CoreModel Fetch unit.">Fetch.cpp</a> / <a class="el" href="Fetch_8hpp.html" title="Definition of the CoreModel Fetch unit.">Fetch.hpp</a> and <a class="el" href="Decode_8cpp_source.html">Decode.cpp</a> / <a class="el" href="Decode_8hpp_source.html">Decode.hpp</a>.</p>
<p>Without the delay of 1 cycle on the <code>in_fetch_queue_write</code>, we will come across a cycle in simulation:</p>
<div class="fragment"><div class="line">Step.Time</div>
<div class="line">   1.0    Fetch receive credits</div>
<div class="line">   2.0    Fetch sends <span class="keyword">new</span> instructions on the out port</div>
<div class="line">   3.0    Decode would receive <span class="keyword">new</span> instructions and process</div>
<div class="line">   4.0    Decode send credits back to Fetch</div>
<div class="line">   5.0    Goto 1?? Oops! Infinite loop!</div>
</div><!-- fragment --><p>Adding the cycle delay:</p>
<div class="fragment"><div class="line">Step.Time</div>
<div class="line">   1.0    Fetch receive credits</div>
<div class="line">   2.0    Fetch sends <span class="keyword">new</span> instructions on the out port</div>
<div class="line">        ... delay</div>
<div class="line">   1.1    Decode would receive <span class="keyword">new</span> instructions and process</div>
<div class="line">   2.1    Decode send credits back to Fetch</div>
<div class="line">   3.1    Fetch receive credits</div>
<div class="line">   4.1    Fetch sends <span class="keyword">new</span> instructions on the out port</div>
<div class="line">        ... delay, etc, etc</div>
</div><!-- fragment --><p>The entire core example follows this paradigm.</p>
<hr  />
 <h1><a class="anchor" id="Building"></a>
Building</h1>
<p>To build the CoreExample, simply type <code>make</code> in the <code>example/CoreModel</code> directory.</p>
<p>Refer to builtin help for up-to-date help and commands, but try running the model with the '-h' option.</p>
<div class="fragment"><div class="line">% ./sparta_core_example -h</div>
<div class="line">% ./sparta_core_example --verbose-help</div>
<div class="line">% ./sparta_core_example --help-topic reporting</div>
</div><!-- fragment --><p>Most of the commands listed in the help are directly from the Sparta framework and not <code>sparta_core_example</code>. These are "free" commands the framework provides (via <a class="el" href="classsparta_1_1app_1_1CommandLineSimulator.html" title="Command line simulator front-end class with argument parsing Works in conjunction with sparta::app::S...">sparta::app::CommandLineSimulator</a>). The modeler is <em>not</em> required to use this class for simulation.</p>
<hr  />
 <h1><a class="anchor" id="Invocations"></a>
Invocations</h1>
<h2><a class="anchor" id="run_config_core_example"></a>
Running/Configuring</h2>
<p>Dump out the parameters:</p>
<div class="fragment"><div class="line">% ./sparta_core_example --<a class="code" href="namespacesparta_1_1utils_1_1has__ostream__operator__impl.html#a9204fde3184baa12ed852d5eb0b7bbae">no</a>-run \</div>
<div class="line">                        --write-<span class="keyword">final</span>-config-verbose params.yaml</div>
</div><!-- fragment --><p>Read in parameters from a file and/or change via the command line. Parameters are set <em>in the order</em> in which they are read from the command line.</p>
<div class="fragment"><div class="line">% ./sparta_core_example -c params.yaml -p top.cpu.core?.fetch.params.num_to_fetch 2</div>
<div class="line"> </div>
<div class="line">  [in] Configuration: Node <span class="stringliteral">&quot;&quot;</span> &lt;- file: <span class="stringliteral">&quot;params.yaml&quot;</span></div>
<div class="line">  [in] Configuration: Parameter <span class="stringliteral">&quot;top.cpu.core?.fetch.params.num_to_fetch&quot;</span> &lt;- value: <span class="stringliteral">&quot;2&quot;</span></div>
</div><!-- fragment --><p>Run for 1 million cycles, incrementing a ctr every 1000 cycles. Consume the config file test.yaml and produce a final yaml file called final.yaml. Also, dump the tree:</p>
<div class="fragment"><div class="line">% ./sparta_core_example -r 1M \</div>
<div class="line">                     --show-tree -p top.core0.params.ctr_incr_period 1000 \</div>
<div class="line">                     -c <a class="code" href="namespacesparta_1_1utils_1_1has__ostream__operator__impl.html#a42ac3ba777d107c7a9458d5c5054cfe7">test</a>.yaml --write-<span class="keyword">final</span>-config <span class="keyword">final</span>.yaml</div>
</div><!-- fragment --><h2><a class="anchor" id="debugging_logging_core_example"></a>
Debugging/Logging</h2>
<p>Enable a Decode "info" log for 1,000 cycles.</p>
<div class="fragment"><div class="line">% ./sparta_core_example -r 1K -l top.cpu.core?.decode info decode.out</div>
</div><!-- fragment --><p>Enable a Decode and Fetch "info" log for 1,000 cycles to the same file:</p>
<div class="fragment"><div class="line">% ./sparta_core_example -r 1K -l top.cpu.core?.decode info fetch_decode.out \</div>
<div class="line">                              -l top.cpu.core?.fetch  info fetch_decode.out</div>
</div><!-- fragment --><p>Enable a Decode and Fetch "info" log for 1K cycles <em>after</em> the first 100K cycles:</p>
<div class="fragment"><div class="line">% ./sparta_core_example --debug-on 100K -r 101K \</div>
<div class="line">                     -l top.cpu.core?.decode info fetch_decode.out \</div>
<div class="line">                     -l top.cpu.core?.fetch  info fetch_decode.out</div>
</div><!-- fragment --><p>Enable a Decode and Fetch "info" log for 1K instructions <em>after</em> the first 100K instructions:</p>
<div class="fragment"><div class="line">% ./sparta_core_example --debug-on-icount 100K -i 101K \</div>
<div class="line">                     -l top.cpu.core?.decode info fetch_decode.out \</div>
<div class="line">                     -l top.cpu.core?.fetch  info fetch_decode.out</div>
</div><!-- fragment --><h2><a class="anchor" id="reporting_core_example"></a>
Generating Reports</h2>
<p>Refer to <a class="el" href="report_def_format.html">Report Definition Format (.rrep,.yaml)</a> for more details on Reports.</p>
<p>Dump out a full, simple report report in html:</p>
<div class="fragment"><div class="line">% ./sparta_core_example -r 1000000 --report-all output.html html</div>
<div class="line">% ./sparta_core_example -r 1M --report-all output.html html  # Same command</div>
</div><!-- fragment --><p>Dump out a full, simple report with rules. The content is all inclusive of the entire simulation tree (the "" on the command line)</p>
<div class="fragment"><div class="line">% cat simple_stats.yaml</div>
<div class="line">content:</div>
<div class="line">subreport:</div>
<div class="line">  name: AUTO</div>
<div class="line">  content:</div>
<div class="line">    autopopulate: <span class="keyword">true</span></div>
<div class="line">% ./sparta_core_example -r 1M --report <span class="stringliteral">&quot;&quot;</span> simple_stats.yaml my_report.txt text</div>
</div><!-- fragment --><p>Dump out subset, but simple report with rules. The content is inclusive of the decode tree only for all cores:</p>
<div class="fragment"><div class="line">% cat simple_stats.yaml</div>
<div class="line">content:</div>
<div class="line">subreport:</div>
<div class="line">  name: AUTO</div>
<div class="line">  content:</div>
<div class="line">    autopopulate: <span class="keyword">true</span></div>
<div class="line">% ./sparta_core_example -r 1M --report <span class="stringliteral">&quot;top.cpu.core?.decode&quot;</span> simple_stats.yaml my_report.txt text</div>
</div><!-- fragment --><p>Create a <code>ts_report.yaml</code> file to dump out a time-series CSV report (must be run in <code>example/CoreModel</code> directory for the <code>core_stats.yaml</code> file). This is triggered on the stat <code>total_number_retired</code> reaching 3500 insts or greater. It's trigged "on" only once.</p>
<div class="fragment"><div class="line">% cat &gt; ts_report.yaml</div>
<div class="line">content:</div>
<div class="line"> </div>
<div class="line">report:</div>
<div class="line">  pattern:   top.cpu.core0</div>
<div class="line">  def_file:  core_stats.yaml</div>
<div class="line">  dest_file: core0.csv</div>
<div class="line">  format:    csv</div>
<div class="line">  trigger:</div>
<div class="line">    start:   rob.stats.total_number_retired &gt;= 3500</div>
<div class="line">    update-time: 5 ns</div>
<div class="line"> &lt;ctrl-D&gt;</div>
<div class="line"> % ./sparta_core_example -r 1M --report ts_report.yaml</div>
</div><!-- fragment --><h2><a class="anchor" id="pipeouts_core_example"></a>
Generating Pipeouts</h2>
<p>Refer to <a href="https://github.com/sparcians/map/tree/master/helios/pipeViewer">https://github.com/sparcians/map/tree/master/helios/pipeViewer</a> for directions on building/installing the MAP::Helios::Argos tools preferably using the Conda tools.</p>
<p>Create a 10K instructions Pipeout:</p>
<div class="fragment"><div class="line">% pwd</div>
<div class="line">$HOME/map/<a class="code" href="namespacesparta.html">sparta</a>/build/example/CoreModel</div>
<div class="line">% ./sparta_core_example -i10K -z my_pipeout</div>
</div><!-- fragment --><p>This will create a set of files for the Argos viewer:</p>
<div class="fragment"><div class="line">% ls -1 my_pipeout*</div>
<div class="line">my_pipeoutclock.dat</div>
<div class="line">my_pipeoutdata.dat</div>
<div class="line">my_pipeoutdisplay_format.dat</div>
<div class="line">my_pipeoutindex.bin</div>
<div class="line">my_pipeoutlocation.dat</div>
<div class="line">my_pipeoutmap.dat</div>
<div class="line">my_pipeoutrecord.bin</div>
<div class="line">my_pipeoutsimulation.info</div>
<div class="line">my_pipeoutstring_map.dat</div>
</div><!-- fragment --><p>Launch the MAP::Helio::Argos viewer (this assumes the correct tools/libaries have been installed). Note that the <code>cpu_layout.alf</code> file is NOT in the build directory of the CoreModel.</p>
<div class="fragment"><div class="line">% pwd</div>
<div class="line">$HOME/map/<a class="code" href="namespacesparta.html">sparta</a>/build/example/CoreModel</div>
<div class="line">% python3 $HOME/map/helios/pipeViewer/pipe_view/argos.py \</div>
<div class="line">       -l $HOME/map/<a class="code" href="namespacesparta.html">sparta</a>/example/CoreModel/cpu_layout.alf \</div>
<div class="line">       -d my_pipeout</div>
</div><!-- fragment --><p>The view that pops up is a <em>single-cycle</em> view of the CPU. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="anamespacesparta_1_1utils_1_1has__ostream__operator__impl_html_a9204fde3184baa12ed852d5eb0b7bbae"><div class="ttname"><a href="namespacesparta_1_1utils_1_1has__ostream__operator__impl.html#a9204fde3184baa12ed852d5eb0b7bbae">sparta::utils::has_ostream_operator_impl::no</a></div><div class="ttdeci">char no</div><div class="ttdoc">Typedef a char array of size one.</div><div class="ttdef"><b>Definition:</b> <a href="DetectMemberUtils_8hpp_source.html#l00030">DetectMemberUtils.hpp:30</a></div></div>
<div class="ttc" id="anamespacesparta_html"><div class="ttname"><a href="namespacesparta.html">sparta</a></div><div class="ttdoc">Macros for handling exponential backoff.</div><div class="ttdef"><b>Definition:</b> <a href="AppTriggers_8hpp_source.html#l00022">AppTriggers.hpp:22</a></div></div>
<div class="ttc" id="anamespacesparta_1_1utils_1_1has__ostream__operator__impl_html_a42ac3ba777d107c7a9458d5c5054cfe7"><div class="ttname"><a href="namespacesparta_1_1utils_1_1has__ostream__operator__impl.html#a42ac3ba777d107c7a9458d5c5054cfe7">sparta::utils::has_ostream_operator_impl::test</a></div><div class="ttdeci">yes &amp; test(std::ostream &amp;)</div><div class="ttdoc">If the class does have an &lt;&lt; operator overloaded,.</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed May 22 2024 13:00:38 for The Sparta Modeling Framework by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
